let step=1;const initialStep=1,finalStep=3,appointment={id:"",name:"",date:"",hour:"",services:[]};function startApp(){tabs(),showSection(),queryAPI(),pagerButtons(),laterPage(),previousPage(),showSummary(),customerId(),customerName(),selectDate(),selectHour()}function showSection(){const e=document.querySelector(".show");e&&e.classList.remove("show");document.querySelector(`#step-${step}`).classList.add("show");const t=document.querySelector(".current");t&&t.classList.remove("current");document.querySelector(`[data-step="${step}"]`).classList.add("current")}function pagerButtons(){const e=document.querySelector("#previous"),t=document.querySelector("#later");1===step?(e.classList.add("hide"),t.classList.remove("hide")):2===step?(e.classList.remove("hide"),t.classList.remove("hide")):3===step&&(e.classList.remove("hide"),t.classList.add("hide"),showSummary()),showSection()}function tabs(){document.querySelectorAll(".tabs button").forEach((e=>{e.addEventListener("click",(e=>{step=parseInt(e.target.dataset.step),showSection(),pagerButtons()}))}))}function previousPage(){document.querySelector("#previous").addEventListener("click",(()=>{step<=initialStep||(step--,pagerButtons())}))}function laterPage(){document.querySelector("#later").addEventListener("click",(()=>{step>=finalStep||(step++,pagerButtons())}))}async function queryAPI(){try{const e="http://localhost:3000/api/services",t=await fetch(e);showServices(await t.json())}catch(e){console.log(e)}}function showServices(e){e.forEach((e=>{const{id:t,name:n,price:o}=e,a=document.createElement("P");a.classList.add("service-name"),a.textContent=n;const s=document.createElement("P");s.classList.add("service-price"),s.textContent=`$${o}`;const r=document.createElement("DIV");r.classList.add("service"),r.dataset.serviceId=t,r.onclick=()=>{selectService(e)},r.appendChild(a),r.appendChild(s),document.querySelector("#services").appendChild(r)}))}function selectService(e){const{id:t}=e,{services:n}=appointment,o=document.querySelector(`[data-service-id="${t}"]`);n.some((e=>e.id===t))?appointment.services=n.filter((e=>e.id!==t)):appointment.services=[...n,e],o.classList.toggle("selected")}function customerId(){appointment.id=document.querySelector("#id").value}function customerName(){appointment.name=document.querySelector("#name").value}function selectDate(){document.querySelector("#date").addEventListener("input",(e=>{const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value="",showAlert("error","Fines de semana no permitidos",".form")):appointment.date=e.target.value}))}function selectHour(){document.querySelector("#hour").addEventListener("input",(e=>{const t=e.target.value.split(":")[0];t<10||t>18?(e.target.value="",showAlert("error","Horas no validas",".form")):appointment.hour=e.target.value}))}function showAlert(e,t,n,o=!0){const a=document.querySelector(".alert");a&&a.remove();const s=document.createElement("DIV");s.textContent=t,s.classList.add("alert"),s.classList.add(e);document.querySelector(n).appendChild(s),o&&setTimeout((()=>{s.remove()}),4e3)}function showSummary(){const e=document.querySelector(".summary-content");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(appointment).includes("")||0===appointment.services.length)return void showAlert("error","Faltan datos de Servicios, Fecha u Hora",".summary-content",!1);const{name:t,date:n,hour:o,services:a}=appointment,s=document.createElement("H3");s.textContent="Resumen de Servicios",e.appendChild(s),a.forEach((t=>{const{id:n,price:o,name:a}=t,s=document.createElement("DIV");s.classList.add("service-container");const r=document.createElement("P");r.textContent=a;const c=document.createElement("P");c.innerHTML=`<span>Precio:</span> ${o}`,s.appendChild(r),s.appendChild(c),e.appendChild(s)}));const r=document.createElement("H3");r.textContent="Resumen de cita",e.appendChild(r);const c=document.createElement("P");c.innerHTML=`<span>Nombre:</span> ${t}`,e.appendChild(c);const i=new Date(n),d=i.getMonth(),l=i.getDate()+2,u=i.getFullYear(),p=new Date(Date.UTC(u,d,l)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),m=document.createElement("P");m.innerHTML=`<span>Fecha:</span> ${p}`,e.appendChild(m);const h=document.createElement("P");h.innerHTML=`<span>Hora:</span> ${o} Horas`,e.appendChild(h);const v=a.reduce(((e,t)=>e+parseFloat(t.price)),0),S=document.createElement("P");S.innerHTML=`<span>Total:</span> $${v}`,e.appendChild(S);const f=document.createElement("BUTTON");f.classList.add("button"),f.textContent="Reservar Cita",f.onclick=reserveAppointment,e.appendChild(f)}async function reserveAppointment(){const{date:e,hour:t,services:n,id:o}=appointment,a=n.map((e=>e.id)),s=new FormData;s.append("date",e),s.append("hour",t),s.append("user_id",o),s.append("services",a);try{const e="http://localhost:3000/api/appointments",t=await fetch(e,{method:"POST",body:s});(await t.json()).result&&Swal.fire({icon:"success",title:"Cita Creada",text:"Tu cita fue creada correctamente",button:"OK"}).then((()=>window.location.reload()))}catch(e){Swal.fire({icon:"error",title:"Error",text:"Hubo un error al intentar reservar su cita, por favor intentelo de nuevo"})}}document.addEventListener("DOMContentLoaded",(()=>{startApp()}));